<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>AppleLogin - Tech Blog</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "AppleLogin";
        var mkdocs_page_input_path = "android/android-appleLogin.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Tech Blog
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">News</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Go</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../go/go-develop-env/">Develop Env</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Grammar</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../go/go-grammar/">API</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Features</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../go/go-grammar/">Go GC</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Library</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../go/go-google-api-usage/">Google API</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">iOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Grammar</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/ios-grammar/">Swift</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Features</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/ios-grammar/">Swift ARC</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Library</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/afnetworking-usage/">AfNetworking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/ios-inapp-purchase-usage/">InAppPurchase</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/app-with-framework/">Create Framework</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/cocoapod-usage/">Cocoapod Usage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/cocoapods-private/">Cocoapod Private</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/cocoapods-public/">Cocoapod Public</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/ios_exclude_simulator_architecture/">Exclude Architecture</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/ios-serviceID-setting/">ServiceID Setting</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ios/use_frameworks_definition/">Framework Definition</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Android</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">Grammar</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../android-grammar/">Kotlin</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Features</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../android-grammar/">Swift ARC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../android-package-refactor/">PackagenameRefactor</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Library</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../acra-usage/">ACRA</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../android-google-billing-usage/">GoogleBilling</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../android-onestore-billing-usage/">OneStoreBilling</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../create-library/">Create Module</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../gson/">Gson</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../retrofit2/">Retrofit2</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">AppleLogin</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Gradle</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../maven-deploy/">Maven</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../jcenter/">Jcenter</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Unity</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Grammar</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/c%23-grammar/">C#</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/unity-api/">API</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Features</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/gradle-version-manage/">Android Gradle</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/unity2017-androidx-use/">AndroidX Use</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/unity_xcode_AddInAppPurchase/">iOS Capability</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/unity-ios-application-override/">iOS Application Override</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Library</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/unity-api/">Asset</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Editor</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../unity/unity-build-machine-shell/">Build Machine</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Docker</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../docker/docker-build-deploy/">Build Deploy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Shell</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../gpg-usage/">GPG Key</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Tech Blog</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Android &raquo;</li>
          <li>Library &raquo;</li>
      <li>AppleLogin</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="_1">안드로이드 환경에서 애플 로그인을 사용하기 위한 설정<a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p><a href="https://whitepaek.tistory.com/60">참고 사이트</a></p>
<h2 id="url">로그인 요청 URL 설정<a class="headerlink" href="#url" title="Permanent link">#</a></h2>
<pre><code class="language-kotlin">private val APPLE_CLIENT_ID = &quot;com.your.client.id.here&quot;
private val APPLE_REDIRECT_URI = &quot;https://your-redirect-uri.com/callback&quot;
private val APPLE_SCOPE = &quot;name%20email&quot;
private val APPLE_AUTH_URL = &quot;https://appleid.apple.com/auth/authorize&quot;

val url = (APPLE_AUTH_URL           
           + &quot;?response_type=code%20id_token&amp;v=1.1.6&amp;response_mode=form_post&amp;client_id=&quot;
           + APPLE_CLIENT_ID + &quot;&amp;scope=&quot;
           + APPLE_SCOPE + &quot;&amp;state=&quot;
           + state + &quot;&amp;redirect_uri=&quot;
           + APPLE_REDIRECT_URI)
</code></pre>
<h2 id="_2">로그인 웹뷰 구성<a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>Java :</p>
<pre><code class="language-java">public class MainActivity extends AppCompatActivity {

    private final String TAG = &quot;MainActivity&quot;;
    private WebView mWebView;
    private String state;

    private final String APPLE_CLIENT_ID = &quot;com.your.client.id.here&quot;;
    private final String APPLE_REDIRECT_URI = &quot;https://your-redirect-uri.com/callback&quot;;
    private final String APPLE_SCOPE = &quot;name%20email&quot;;
    private final String APPLE_AUTH_URL = &quot;https://appleid.apple.com/auth/authorize&quot;;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_webview);

        mWebView = findViewById(R.id.webView);

        WebSettings webSettings = mWebView.getSettings();
        webSettings.setJavaScriptEnabled(true);
        webSettings.setJavaScriptCanOpenWindowsAutomatically(true);
        mWebView.setWebChromeClient(new WebChromeClient());
        mWebView.setWebViewClient(new WebViewClient() {
            @Override
            public void onReceivedError(WebView view, int errorCode, String description, String failingUrl)
            {
                mWebView.loadUrl(&quot;about:blank&quot;);
                String errorMessage = &quot;Error &quot; + errorCode + &quot;: &quot; + description + &quot; [&quot; + failingUrl + &quot;]&quot;;
            }

            @Override
            public void onPageStarted(WebView view, String url, Bitmap favicon) {
            }

            @Override
            public void onPageFinished(WebView view, String url) {
            }

            @Override
            public boolean shouldOverrideUrlLoading(WebView view, String url)
            {
                return isUrlOverridden(view, Uri.parse(url));
            }

            @RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)
            @Override
            public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
                return isUrlOverridden(view, request.getUrl());
            }
        });

        state = getUUID();

        String url = APPLE_AUTH_URL
                + &quot;?response_type=code%20id_token&amp;v=1.1.6&amp;response_mode=form_post&amp;client_id=&quot;
                + APPLE_CLIENT_ID + &quot;&amp;scope=&quot;
                + APPLE_SCOPE + &quot;&amp;state=&quot;
                + state + &quot;&amp;redirect_uri=&quot;
                + APPLE_REDIRECT_URI;

        mWebView.loadUrl(url);
    }

    private String getUUID()
    {
        return UUID.randomUUID().toString();
    }

    private boolean isUrlOverridden(WebView view, Uri url)
    {
        boolean ret = false;
        if(url == null) {
            ret = false;
        }else if(url.toString().contains(&quot;appleid.apple.com&quot;)){
            Log.d(TAG, &quot;appleid.apple.com&quot;);
            view.loadUrl(url.toString());
            ret = true;
        }else if (url.toString().contains(APPLE_REDIRECT_URI)){
            String codeParam = url.getQueryParameter(&quot;code&quot;);
            String stateParam = url.getQueryParameter(&quot;state&quot;);
            String idTokenParam = url.getQueryParameter(&quot;id_token&quot;);
            String userParam = url.getQueryParameter(&quot;user&quot;);

            if(codeParam == null){
                Log.d(TAG, &quot;code not returned&quot;);
                Toast.makeText(getApplicationContext(), &quot;로그인 실패&quot;, Toast.LENGTH_SHORT).show();

            }else if(!stateParam.equals(state)){
                Log.d(TAG, &quot;state does not match&quot;);
                Toast.makeText(getApplicationContext(), &quot;로그인 실패&quot;, Toast.LENGTH_SHORT).show();

            }else{

                if(userParam != null)
                    Log.d(TAG, userParam);
                if(idTokenParam != null)
                    Log.d(TAG, jwtDecoded(idTokenParam));

                Toast.makeText(getApplicationContext(), &quot;로그인 성공&quot;, Toast.LENGTH_SHORT).show();
            }
            ret = true;
        }

        return ret;
    }

    private String jwtDecoded(String JWTEncoded)
    {
        String decodedJson = &quot;&quot;;
        try {
            String[] split = JWTEncoded.split(&quot;\\.&quot;);
            Log.d(TAG, &quot;Header: &quot; + getJson(split[0]));
            Log.d(TAG, &quot;Body: &quot; + getJson(split[1]));

            decodedJson = getJson(split[1]);
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return decodedJson;
    }

    private String getJson(String strEncoded) throws UnsupportedEncodingException{
        byte[] decodedBytes = Base64.decode(strEncoded, Base64.URL_SAFE);
        return new String(decodedBytes, &quot;UTF-8&quot;);
    }
}
</code></pre>
<p>Kotlin:</p>
<pre><code class="language-kotlin">class SampleActivity : AppCompatActivity() {

    private val TAG = &quot;SampleActivity&quot;
    private var mWebView: WebView? = null
    private var state: String? = null

    private val APPLE_CLIENT_ID = &quot;com.your.client.id.here&quot;
    private val APPLE_REDIRECT_URI = &quot;https://your-redirect-uri.com/callback&quot;
    private val APPLE_SCOPE = &quot;name%20email&quot;
    private val APPLE_AUTH_URL = &quot;https://appleid.apple.com/auth/authorize&quot;

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_webview)
        mWebView = findViewById(R.id.webView)

        val webSettings = mWebView?.settings
        webSettings?.javaScriptEnabled = true
        webSettings?.javaScriptCanOpenWindowsAutomatically = true
        mWebView?.webChromeClient = WebChromeClient()
        mWebView?.webViewClient = object : WebViewClient() {
            override fun onReceivedError(view: WebView, errorCode: Int, description: String, failingUrl: String) {
                mWebView?.loadUrl(&quot;about:blank&quot;)
                val errorMessage = &quot;Error $errorCode: $description [$failingUrl]&quot;
            }

            override fun onPageStarted(view: WebView?, url: String?, favicon: Bitmap?) {}
            override fun onPageFinished(view: WebView?, url: String?) {}
            override fun shouldOverrideUrlLoading(view: WebView?, url: String?): Boolean {
                return isUrlOverridden(view, Uri.parse(url))
            }

            @RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)
            override fun shouldOverrideUrlLoading(view: WebView, request: WebResourceRequest): Boolean {
                return isUrlOverridden(view, request.url)
            }
        }
        state = getUUID()
        val url = (APPLE_AUTH_URL
                + &quot;?response_type=code%20id_token&amp;v=1.1.6&amp;response_mode=form_post&amp;client_id=&quot;
                + APPLE_CLIENT_ID + &quot;&amp;scope=&quot;
                + APPLE_SCOPE + &quot;&amp;state=&quot;
                + state + &quot;&amp;redirect_uri=&quot;
                + APPLE_REDIRECT_URI)

        mWebView?.loadUrl(url)
    }

    private fun getUUID(): String? {
        return UUID.randomUUID().toString()
    }

    private fun isUrlOverridden(view: WebView?, url: Uri?): Boolean {
        return when {
            url == null -&gt; {
                false
            }
            url.toString().contains(&quot;appleid.apple.com&quot;) -&gt; {
                view?.loadUrl(url.toString())
                true
            }
            url.toString().contains(APPLE_REDIRECT_URI) -&gt; {
                val codeParam = url.getQueryParameter(&quot;code&quot;)
                val stateParam = url.getQueryParameter(&quot;state&quot;)
                val idTokenParam = url.getQueryParameter(&quot;id_token&quot;)
                val userParam = url.getQueryParameter(&quot;user&quot;)

                when {
                    codeParam == null -&gt; {
                        Log.d(TAG, &quot;code not returned&quot;)
                        Toast.makeText(applicationContext, &quot;로그인 실패&quot;, Toast.LENGTH_SHORT).show()
                        finish()
                    }
                    stateParam != state -&gt; {
                        Log.d(TAG, &quot;state does not match&quot;)
                        Toast.makeText(applicationContext, &quot;로그인 실패&quot;, Toast.LENGTH_SHORT).show()
                        finish()
                    }
                    else -&gt; {
                        if(userParam != null)
                            Log.d(TAG, userParam)
                        if(idTokenParam != null)
                            Log.d(TAG, jwtDecoded(idTokenParam))

                        Toast.makeText(applicationContext, &quot;로그인 성공&quot;, Toast.LENGTH_SHORT).show()
                        finish()
                    }
                }

                true
            }
            else -&gt; {
                false
            }
        }
    }

    private fun jwtDecoded(JWTEncoded: String): String? {
        var decodedJson = &quot;&quot;
        try {
            val split = JWTEncoded.split(&quot;\\.&quot;.toRegex()).toTypedArray()
            Log.d(TAG, &quot;Header: &quot; + getJson(split[0]))
            Log.d(TAG, &quot;Body: &quot; + getJson(split[1]))
            decodedJson = getJson(split[1])
        } catch (e: UnsupportedEncodingException) {
            e.printStackTrace()
        }
        return decodedJson
    }

    @Throws(UnsupportedEncodingException::class)
    private fun getJson(strEncoded: String): String {
        val decodedBytes = Base64.decode(strEncoded, Base64.URL_SAFE)
        return String(decodedBytes, charset(&quot;UTF-8&quot;))
    }
}
</code></pre>
<h2 id="redirect-uri">Redirect URI<a class="headerlink" href="#redirect-uri" title="Permanent link">#</a></h2>
<p>redirect uri 설정시 애플서버에서 post 로 로그인정보를 request 할 것이다. 이때 반드시 서버내에서 redirect 를 해줘야 한다.</p>
<p>그래야 클라이언트 웹뷰에서 shouldOverrideUrlLoading 로 redirect 된 정보를 받을 수 있기 때문이다.</p>
<h2 id="2">2차검증<a class="headerlink" href="#2" title="Permanent link">#</a></h2>
<p>Server to Server 로 진행하는 토큰검증하는 내용은 포함하고 있지 않습니다.</p>
<p><a href="https://whitepaek.tistory.com/61">별도로 참고할 사이트 안내해드립니다.</a></p>
<blockquote>
<p>출처</p>
<p>https://stackoverflow.com/questions/37695877/how-can-i-decode-jwt-token-in-android</p>
</blockquote>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../retrofit2/" class="btn btn-neutral float-left" title="Retrofit2"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../maven-deploy/" class="btn btn-neutral float-right" title="Maven">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../retrofit2/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../maven-deploy/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
